<!DOCTYPE html>
<link rel="stylesheet" href="tutorials.css">
<title>SQL Tutorials: Window Functions</title>
<header>
<h1 style="text-align:center;">SQL Tutorials</h1>
    <div class="navbar">
        <a href="/Tutorials/SQLTutorials.html">Return to Home</a>
        <div class="dropdown" style="margin-left:80px;">
            <button class="dropbtn" style="margin-left:80px;">Learning Paths
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content" style="min-width:150px;margin-left:5.2%;">
            <a href="DSBeginner.html">Data Science</a>
            <a href="DSIntermediate.html">Data Engineering</a>
            <a href="DSAdvanced.html">Software Engineering</a>
            <a href="Projects.html">Data Analytics</a>
          </div>
        </div>
        <div class="dropdown" style="margin-left:0px;">
            <button class="dropbtn" style="margin-left:60px;">Challenges
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content" style="max-width:190px;margin-left:4%;">
            <a href="DEBeginner.html">Beginner</a>
            <a href="DEIntermediate.html">Intermediate</a>
            <a href="DEAdvanced.html">Advanced</a>
          </div>
        </div>
        <div class="dropdown">
          <button class="dropbtn">Projects
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content" style="min-width:170px;margin-left:5.2%;">
            <a href="SEBeginner.html">Beginner</a>
            <a href="SEIntermediate.html">Intermediate</a>
            <a href="SEAdvanced.html">Advanced</a>
          </div>
        </div>
        <div class="dropdown" style="margin-left:0px;">
            <button class="dropbtn" style="margin-left:60px;">Related Topics
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content" style="min-width:155px;margin-left:4.5%;">
            <a href="DABeginner.html">Python</a>
            <a href="DAIntermediate.html">NoSQL Databases</a>
            <a href="DAAdvanced.html">Tableau</a>
            <a href="Projects.html">Pandas</a>
          </div>
        </div>
      </div>
  </header>
  <div class="wrapperTutorials" style="width:1200px;">
    <section>
      <h2><u>ADVANCED SQL: WINDOW FUNCTIONS</u></h2><br><br>
      <h3 style="margin-left:99px;"><b><u>Introduction</u></b></h3>
      <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
        Welcome to the first ADVANCED tutorial in this learning series! This section will primarily focus on working with large datasets. One of the most common methods to analyze large amounts of data is to <b><i>partition</i></b>, or separate, the data into individual groups. This can be done using various <b>Window Functions.</b> A <b><i>Window Function</i></b> splits the data into individual groups based on a specified boundary (e.g., id, name, date). These are widely used for creating running totals, grouping data without changing the level of detail, and making it easier to identify potential duplicates. There are tens of window function available, so we'll just be focusing on the following categories:
        <ul style="margin-left:110px;">
            <li style="line-height:25px;">Ranking Functions</li>
            <li style="line-height:25px;">Aggregate Functions</li>
            <li style="line-height:25px;">Comparison Functions</li>
            <li style="line-height:25px;">Statistical Functions</li>
        </ul>
      </p>
    </div>

                                                       <!-- Rollup Extension -->
    <div class="wrapperTutorials" style="width:1200px;">
        <section>
      <h3 style="margin-left:99px;font-size:30px;"><b>RANKING FUNCTIONS</b></h3>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
            Within every organization, there is a need to measure attributes between various groups or departments. This allows organizations to create more detailed Key Performance Indicators (KPIs) and allow managers to measure the performance of their employees. Before we start learning about these functions, let's take a look at the general syntax below:</i></b><br>
            <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:18px;line-height:25px;">
                [window function name]() <b>OVER</b>(<b>PARTITION BY</b> [column name] ORDER BY [column name]) [new column name]
            </p>
        </p>
        <h4 style="margin-left:99px;font-size:25px;">ROW_NUMBER</h4>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
            The purpose of the ROW_NUMBER function is to specify the index number of each row within a partition. In the example below, we will illustrate how this function can be used in conjunction with CTEs:
        </p>
        <div class="grid-container">
            <h4 style="font-size:22px;color:black;" class="item1"><b>Example</b></h4>
            <h4 style="font-size:22px;color:black;" class="item2"><b>Output</b></h4>
        </div>
            <div class="grid-container">
        <p style="text-align:justify;padding-left:0px;padding-right:50px;font-size:16px;line-height:20px;color:black;font-weight:lighter;margin-left:0px;" class="item1">
        &ensp;&ensp;&ensp;-- Get all rows from table<br>
        &ensp;&ensp;&ensp;WITH all_tracks AS (<br> 
        &ensp;&ensp;&ensp;SELECT * FROM tracks),<br><br>
        &ensp;&ensp;&ensp;-- find the songs that occur more than once<br>
        &ensp;&ensp;&ensp;track_num AS ( <br>
        &ensp;&ensp;&ensp;SELECT track, artist<br>
        &ensp;&ensp;&ensp;FROM tracks<br>
        &ensp;&ensp;&ensp;GROUP BY track, artist<br>
        &ensp;&ensp;&ensp;HAVING COUNT(*) > 1),<br><br>
        &ensp;&ensp;&ensp;-- assign row numbers<br>
        &ensp;&ensp;&ensp;row_nums AS (<br>
        &ensp;&ensp;&ensp;SELECT <b>ROW_NUMBER()<br>
        &ensp;&ensp;&ensp;OVER(PARTITION BY track ORDER BY track, artist) row_num,</b><br>
        &ensp;&ensp;&ensp;track, artist<br>
        &ensp;&ensp;&ensp;FROM all_tracks<br><br>
        &ensp;&ensp;&ensp;-- join tables together<br>
        &ensp;&ensp;&ensp;SELECT row_nums.* FROM row_nums<br>
        &ensp;&ensp;&ensp;JOIN track_num ON row_nums.track = track_num.track<br>
        &ensp;&ensp;&ensp;ORDER BY row_nums.track, row_nums.artist, row_num;
        </p>
        <img style="margin-bottom:20px;" src="Images/rownumberex.jpg" class="item2">
    </div>
    <h4 style="margin-left:99px;font-size:25px;">RANK</h4>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
            As you might assume, this function is used to rank items within a specified group. This is commonly used to identify the best-selling products, most-productive employees, and highest gross profit. The one difference between this function and the ROW_NUMBER function is that the ORDER BY clause is REQUIRED.
        </p>
        <div class="grid-container">
            <h4 style="font-size:22px;color:black;" class="item1"><b>Example</b></h4>
            <h4 style="font-size:22px;color:black;" class="item2"><b>Output</b></h4>
        </div>
            <div class="grid-container">
        <p style="text-align:justify;padding-left:0px;padding-right:50px;font-size:16px;line-height:25px;color:black;font-weight:lighter;margin-left:0px;" class="item1">
        &ensp;&ensp;&ensp;SELECT <b>RANK() OVER(PARTITION BY artist_name </b><br>
        &ensp;&ensp;&ensp;<b>ORDER BY track_count DESC)</b> popularity_rank, track_name<br> 
        &ensp;&ensp;&ensp;artist_name, track_count<br>
        &ensp;&ensp;&ensp;FROM song_popularity<br>
        &ensp;&ensp;&ensp;WHERE track_count > 3;
        </p>
        <img style="margin-bottom:20px;" src="Images/rankex.jpg" class="item2">
    </div>
    <h4 style="margin-left:99px;font-size:25px;">DENSE_RANK</h4>
    <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
        The main issue with the RANK function is that it skips ranks when there are duplicate values. This can make it difficult to interpret the results. To help with this, the DENSE_RANK function continues the rank rather than skips. This is usually used in place of the RANK function. In the example below, the highlighted rows show a great example of continuing the rank. If the RANK function was used the next row after the second highlighted row would be Ranked 4th.
    </p>
    <div class="grid-container">
        <h4 style="font-size:22px;color:black;" class="item1"><b>Example</b></h4>
        <h4 style="font-size:22px;color:black;" class="item2"><b>Output</b></h4>
    </div>
        <div class="grid-container">
    <p style="text-align:justify;padding-left:0px;padding-right:50px;font-size:16px;line-height:25px;color:black;font-weight:lighter;margin-left:0px;" class="item1">
    &ensp;&ensp;&ensp;SELECT <b>DENSE_RANK() <br>
    &ensp;&ensp;&ensp;OVER(PARTITION BY artist_name </b><br>
    &ensp;&ensp;&ensp;<b>ORDER BY track_count DESC)</b> popularity_rank, track_name<br> 
    &ensp;&ensp;&ensp;artist_name, track_count<br>
    &ensp;&ensp;&ensp;FROM song_popularity<br>
    &ensp;&ensp;&ensp;WHERE track_count > 3;
    </p>
    <img style="margin-bottom:40px;" src="Images/denserankex.jpg" class="item2">
</div>
    </section>
    </div>

                                                        <!-- Cube Extension -->
    <div class="wrapperTutorials" style="width:1200px;">
        <section>
        <h3 style="margin-left:99px;font-size:30px;"><b>AGGREGATE FUNCTIONS</b></h3>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
            As mentioned in the Group By Extensions Tutorial, running totals and moving average allow businesses to see how pars contribute to a whole over time. This is the basic premise of the aggregate window functions. These allow you to see the cumulative amounts or moving averages in each group. This method is very similar to the CUBE or ROLLUP Group By Extensions, though these provide a more sophisticate view of your data and tned to be more accurate.
        <h4 style="margin-left:99px;font-size:25px;">SUM</h4>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
            As mentioned above, this function is a more sophisticated version of the ROLLUP Group By Extension. This window function allows you to see the cumulative sum of values within a group over a period of time or a series of events. In the example below, we will be creating a running total:
        </p>
        <div class="grid-container">
            <h4 style="font-size:22px;color:black;" class="item1"><b>Example</b></h4>
            <h4 style="font-size:22px;color:black;" class="item2"><b>Output</b></h4>
        </div>
            <div class="grid-container">
        <p style="text-align:justify;padding-left:0px;padding-right:50px;font-size:16px;line-height:25px;color:black;font-weight:lighter;margin-left:0px;" class="item1">
        &ensp;&ensp;&ensp;SELECT track_name, artist_name, track_count,<br> 
        &ensp;&ensp;&ensp;<b>SUM(track_count) OVER(PARTITION BY artist_name)</b><br>
        &ensp;&ensp;&ensp;running_total<br>
        &ensp;&ensp;&ensp;FROM song_popularity<br>
        &ensp;&ensp;&ensp;WHERE track_count > 3<br>
        &ensp;&ensp;&ensp;ORDER BY artist_name, track_count
        </p>
        <img style="margin-bottom:20px;" src="Images/runningtotalex.jpg" class="item2">
    </div>
    <h4 style="margin-left:99px;font-size:25px;">AVG (AVERAGE)</h4>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
            When working with metrics that are based on continuous measures rather than discrete, it can be daunting to calculate the moving average. To help solve this, the average window function allows us to see how averages within a group changes over time.
        </p>
        <div class="grid-container">
            <h4 style="font-size:22px;color:black;" class="item1"><b>Example</b></h4>
            <h4 style="font-size:22px;color:black;" class="item2"><b>Output</b></h4>
        </div>
            <div class="grid-container">
        <p style="text-align:justify;padding-left:0px;padding-right:50px;font-size:16px;line-height:25px;color:black;font-weight:lighter;margin-left:0px;" class="item1">
            &ensp;&ensp;&ensp;SELECT track_name, artist_name, track_count,<br> 
            &ensp;&ensp;&ensp;<b>AVG(track_count) OVER(PARTITION BY artist_name)</b><br>
            &ensp;&ensp;&ensp;moving_average<br>
            &ensp;&ensp;&ensp;FROM song_popularity<br>
            &ensp;&ensp;&ensp;WHERE track_count > 3<br>
            &ensp;&ensp;&ensp;ORDER BY artist_name, track_count
        </p>
        <img style="margin-bottom:40px;" src="Images/movingaverageex.jpg" class="item2">
    </div>
        </section>
        </div>

                                                         <!-- Conclusion -->
    <div class="wrapperTutorials" style="width:1200px;">
    <section>
        <h3 style="margin-left:99px;font-size:30px;"><b>COMPARISON FUNCTIONS</b></h3>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
        Have you ever wondered how stock brokers get rich fast? They take past data and compare it with current data. This is the basic premise of comparison window functions. It takes the current row value and compares it with either the first value, last value, previous value, or future value in the group.</p>
        <h4 style="margin-left:99px;font-size:25px;">LAG</h4>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
            As mentioned above, analysts compare past and current data to predict future outcomes. The LAG function allows you to do just that. It simply takes the value of the previous N rows and compares it with the current row:
        </p>
        <div class="grid-container">
            <h4 style="font-size:22px;color:black;" class="item1"><b>Example</b></h4>
            <h4 style="font-size:22px;color:black;" class="item2"><b>Output</b></h4>
        </div>
            <div class="grid-container">
        <p style="text-align:justify;padding-left:0px;padding-right:50px;font-size:16px;line-height:25px;color:black;font-weight:lighter;margin-left:0px;" class="item1">
            &ensp;&ensp;&ensp;-- get previous values<br>
            &ensp;&ensp;&ensp;WITH lag_value AS (<br>
            &ensp;&ensp;&ensp;SELECT track_name, artist_name, track_count,<br> 
            &ensp;&ensp;&ensp;<b>LAG(track_count, 1) OVER(PARTITION BY artist_name<br>
            &ensp;&ensp;&ensp;ORDER BY track_count)</b><br>
            &ensp;&ensp;&ensp;previous_value<br>
            &ensp;&ensp;&ensp;FROM song_popularity<br>
            &ensp;&ensp;&ensp;WHERE track_count > 3)<br><br>
            &ensp;&ensp;&ensp;-- create column for comparison<br>
            &ensp;&ensp;&ensp;SELECT *, (previous_value - track_count) difference<br>
            &ensp;&ensp;&ensp;FROM lag_value<br>
            &ensp;&ensp;&ensp;ORDER BY artist_name, track_count
        </p>
        <img style="margin-bottom:40px;width:550px;" src="Images/lagvalueex.jpg" class="item2">
    </div>
        </section>
        </div>

        <div class="wrapperTutorials" style="width:1200px;">
            <section>
                <h3 style="margin-left:99px;font-size:30px;"><b>STATISTICAL FUNCTIONS</b></h3>
                <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
                </p>
                <div class="grid-container">
                    <h4 style="font-size:22px;color:black;" class="item1"><b>Example</b></h4>
                    <h4 style="font-size:22px;color:black;" class="item2"><b>Output</b></h4>
                </div>
                    <div class="grid-container">
                <p style="text-align:justify;padding-left:0px;padding-right:50px;font-size:16px;line-height:25px;color:black;font-weight:lighter;" class="item1">
                &ensp;&ensp;&ensp;SELECT state, month, SUM(sales) runningTotal<br>
                &ensp;&ensp;&ensp;FROM sales<br>
                &ensp;&ensp;&ensp;GROUP BY <b>GROUPING SETS</b> ((state, month), (state), (month)) <br>
                &ensp;&ensp;&ensp;ORDER BY state, CASE month<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;
                                                  WHEN 'January' THEN 1<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;
                                                  WHEN 'February' THEN 2<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;
                                                  WHEN 'March' THEN 3<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;
                                                  ELSE 4<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;
                                                  END, levelOfDetail
                                                </p>
                
                <img style="margin-bottom:20px;" src="Images/groupingsetsex.jpg" class="item2">
            </div>
                </section>
                </div>

        <div class="wrapperTutorials" style="width:1200px;">
            <section>
                <h3 style="margin-left:99px;font-size:30px;"><b>CONCLUSION</b></h3>
                <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
                Data analysis in SQL can be very powerful, yet challenging to comprehend. As you may have noticed in the examples above, it can be difficult to see the difference between the different groups as far as which group in contributing the most or least. To help with this it's criticial to become proficient in basic Data Visualization techniques. Before continuing in this learning series, I would HIGHLY recomnmend checking how either the <a href="TableauTutorials.html">Tableau</a> or <a href="PowerBITutorials.html">Power BI</a> tutorials.</p>
                </section>
                </div>

                                                        <!-- Next Steps -->
    <div class="wrapperTutorials" style="width:1200px;">
        <section>
        <h3 style="margin-left:99px;font-size:22px;"><b><u>Next Steps</u></b></h3><p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">Querying techniques in SQL supercede everything. Now that we know how to perform some basic analytical techniques, let's look at how to create analytical tables::<br>
            <a href="GroupByExtensions.html" style="text-decoration:none;color:black;font-weight:bolder;">- Group By Extensions Tutorial  (Click here)</a>
        </p>
        </section>
        </div>
        </p>


    
</html>