<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google Font (IBM Plex Sans Condensed) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet"
    >

    <!-- Bootstrap (5.2.3) -->
    <link rel="stylesheet" href="../../css/bootstrap.css">  <!-- %UPDATE% -->
    <script defer src="../../js/bootstrap.bundle.min.js"></script>  <!-- %UPDATE% -->

    <!-- Favicon. -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="../../css/website-base.css">  <!-- %UPDATE% -->
    <title>SQL Tutorials: Common Table Expressions | Data Science Club @ UVU</title>
</head>
<body>
    <!-- Header for title of webpage. -->
    <header class="container-fluid">
        <div class="row py-4 bg-primary">
            <h1 class="col text-center text-white">
                SQL TUTORIALS
            </h1>
        </div>
    </header>
    <!--- Navigation banner. -->
    <nav class="navbar navbar-expand-lg sticky-top py-0 navbar-dark bg-secondary">
        <!-- Container for entire navbar. -->
        <div class="container-fluid justify-content-end px-1">
            <!-- Hamburger menu that appears when screen gets smaller. -->
            <button class="navbar-toggler my-1" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- Container for navbar items. -->
            <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item mx-4">
                        <a class="nav-link text-center" href="../../index.html">Home</a>  <!-- %UPDATE% -->
                    </li>
                    <li class="nav-item mx-4">
                        <a class="nav-link text-center" href="../../tutorials.html">Tutorials</a>  <!-- %UPDATE% -->
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Outer wrapper for main content. -->
    <div class="container-fluid" id="contentWrapper">
        <div class="row">
            <div class="col-md-1 col-lg-2 col-xxl-3"></div>
            <!-- Container for main content. -->
            <div class="col-12 col-md-10 col-lg-8 col-xxl-6 my-md-4 py-3 py-sm-4 px-0 px-sm-3 bg-white">
                <section class="container-fluid">
                    <!-- Title. -->
                    <div class="row">
                        <h2 class="col mb-3 mx-2 mx-sm-1 text-start border-start border-3 border-secondary text-primary">
                            SQL Tutorials: Common Table Expressions (CTEs)
                        </h2>
                    </div>
                    <!-- Title/image. -->
                    <div class="row">
                        <div class="d-flex justify-content-center">
                            <img
                                class="img-fluid"
                                src="../../imgs/common-table-expressions.png"
                                alt="[Enter image here]"
                                width=100%
                            >  <!-- %UPDATE% -->
                        </div>
                    </div>
                    <!-- Description. -->
                    <div class="row mt-2 mb-3">
                        <div class="col">
                            <p class="pt-2">
                                In the previous tutorial, we learned how Subqueries can be used to compare query results without using multiple joins.
                                However, when using multiple Subqueries, it can become very difficult to see where one Subquery ends and another begins.
                                Enter the Common Table Expression (CTE). This tutorial will cover the following learning objectives:
                            </p>
                            <ul>
                                <li>Subqueries vs. CTEs</li>
                                <li>CTE Syntax</li>
                                <li>Use Cases</li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <h2 class="mt-5 px-4 px-sm-3 border-start border-3 border-secondary">Subqueries vs. CTEs</h2>
                        <p class="pt-3">When writing complex queries, it may be tempting to use multi-nested Subqueries in the WHERE Clause. However,
                            this makes it much more difficult to read the query. <b><i>Common Table Expressions (CTEs)</b></i> help solve this problem.
                            Watch the following videos to better understand this concept:
                        </p>
                        <ul>
                            <a href="https://www.youtube.com/watch?v=tlvxb7UduJw">When to Use a Subquery in SQL</a><br>
                            <a href="https://youtube.com/clip/UgkxuVAfNeQNGHvqXMmlIb5UNEvNenFhYgV1">What is a CTE?</a>
                        </ul>
                        <h4 class="pt-4">Summary</h4>
                        <ul>
                            <li class="pt-1">You should use a subquery when the results of one query need to be used in another query.
                            </li>
                            <li class="pt-4">When working with Subqueries in the WHERE Clause, the Subquery must either be a single value 
                                (when comparing aggregates) or a list of values from a single column (when working with categorical data).
                            </li>
                            <li class="pt-4">Whether your query is using Subqueries or CTEs, break down your query and write it in parts. This makes
                                your query much more readable.
                            </li>
                            <li class="pt-4"><b><i>Common Table Expressions (CTEs)</i></b> have the same benefits and use cases as Subqueries, though are
                                much easier to read.
                            </li>
                            </ul>
                        <h2 class="mt-5 px-4 px-sm-3 border-start border-3 border-secondary">CTE Syntax</h2>
                        <p class="pt-3">Now that you have a basic understanding of when to use a CTE, let's learn how to write one. Watch the following
                            video to get a better understanding of this concept:
                        </p>
                        <ul>
                            <a href="https://www.youtube.com/watch?v=_SanZ41uTlw">SQL WITH Statements (Common Table Expressions - CTE)</a>
                        </ul>
                        <h4 class="pt-4">Summary:</h4>
                        <ul>
                            <li class="pt-1"><b><i>CTEs</i></b> are used to make reading multiple Subqueries easier. To create a CTE with a single
                                Subquery, use the following syntax:
                                <br><code>WITH [alias] AS (
                                    <br>SELECT [col1], [col2]
                                    <br>FROM [table_name]
                                    <br>WHERE [list of conditions]
                                    <br>)
                                    <br>
                                    <br>SELECT *
                                    <br>FROM [cte_alias]
                                    <br>WHERE [list of conditions];
                                </code>
                            </li>
                            <li class="pt-4">To create a CTE with multiple Subqueries, use the following syntax:
                                <br><code>WITH [alias1] AS (
                                    <br>SELECT [col1], [col2]
                                    <br>FROM [table_name]
                                    <br>WHERE [list of conditions]
                                    <br>),
                                    <br><br>
                                    [alias2] AS (
                                    <br>SELECT [col1], [col2]
                                    <br>FROM [alias1]
                                    <br>WHERE [list of conditions]
                                    <br>
                                    )
                                    <br>
                                    <br>SELECT *
                                    <br>FROM [cte_alias]
                                    <br>WHERE [list of conditions];</code>
                            </li>
                            </ul>
                        <h2 class="mt-5 px-4 px-sm-3 border-start border-3 border-secondary">Use Cases</h2>
                        <p class="pt-3">Although we have already covered some of the common use cases behind CTEs, let's dive deeper into
                            why they are preferred over Subqueries. Watch the following video to get a better understanding of this concept:
                        </p>
                        <ul>
                            <a href="https://www.youtube.com/watch?v=UcTuw1klZJU">When to Use CTE</a>
                        </ul>
                        <h4 class="pt-4">Summary:</h4>
                        <ul>
                            <li class="pt-1">CTEs are used in-memory and avoid creating temp tables (which are created when using Subqueries).
                            </li>
                            <li class="pt-4">As a Database Administrator (DBA), CTEs make it much easier to allow new users to view previous
                                queries without having to give them unnecessary security privileges.
                            </li>
                            <li class="pt-4">Although CTEs contain more lines of code than traditional Subqueries, they make it easier to update
                                the Subqueries as explained in the video.
                            </li>
                            <li class="pt-4">CTEs prevent human error by only requiring updates in a single Subquery rather than multiple.
                            </li>
                            </ul>
                        <h2 class="mt-5 px-4 px-sm-3 border-start border-3 border-secondary" id="exercise">Exercise</h2>
                        <p><b>Congratulations!</b> You just completed the Common Table Expressions (CTEs) Tutorial! To help test your knowledge, let's
                            complete the same questions as the previous exercise, but using CTEs rather than Subqueries. This exercise is based on 
                            the exercise of the previous tutorial. <br>**<b><i>It's highly recommended that you
                            complete the exercise outlined in the previous tutorial before beginning this exercise.**</i></b>
                            </i></b>
                        </p>
                        <h4 class="pt-3">Instructions:</h4>
                        <ol>
                            <li class="pt-2">Open your RDBMS client.</li>
                            <li class="pt-4">Using the "Sales database, solve the following problems:</li>
                            <ol type="a">
                                <li class="pt-2"><b>Using a CTE, write a query that returns all orders with a purchase_price greater than the
                                    average purchase_price.
                                </b></li>
                                <li class="pt-2"><b>Using a CTE, write a query that returns the highest purchase_price.</b></li>
                                <li class="pt-2"><b>Using a CTE, write a query that returns revenue by order date. Filter to include the following
                                    states: "CA", "CO", "CT".
                                </b></li>
                            </ol>
                            <li class="pt-4"><b>Exercise Completed! Click <a href="Common-Table-Expressions-Answer-Key.html">here</a> to view the answers.</b></li>
                            <div class="col">
                                <p class="pt-4">Have any issues with the above exercise? Post your question on Discord!</p>
                            </div>
                        </ol>
                        <!-- Previous/Next Topic buttons. -->
                    <div class="row mt-4 mt-md-5 mb-2 px-3">
                        <a
                            class="col-12 col-sm-4 btn btn-outline-primary mb-3 mb-sm-0 py-2 fs-5"
                            href="Subqueries.html">
                            Previous Topic
                        </a>
                        <div class="col-0 col-sm-4"></div>
                        <a
                            class="col-12 col-sm-4 btn btn-outline-primary py-2 fs-5"
                            href="#">
                            Next Topic
                        </a>
                    </div>
                </section>
            </div>
            <div class="col-md-1 col-lg-2 col-xxl-3"></div>
        </div>
    </div>
    <!-- Footer at bottom of page. -->
    <footer class="container-fluid bg-secondary">
        <div class="row align-items-center h-100">
            <h4 class="col m-0 text-center text-white">
                © 2023 Data Science Club @ UVU
            </h4>
        </div>
    </footer>
</body>
</html>
