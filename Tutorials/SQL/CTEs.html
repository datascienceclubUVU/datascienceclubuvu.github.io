<!DOCTYPE html>
<link rel="stylesheet" href="tutorials.css">
<title>SQL Tutorials: CTEs</title>
<header>
<h1 style="text-align:center;">SQL Tutorials</h1>
    <div class="navbar">
        <a href="/Tutorials/SQLTutorials.html">Return to Home</a>
        <div class="dropdown" style="margin-left:80px;">
            <button class="dropbtn" style="margin-left:80px;">Learning Paths
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content" style="min-width:150px;margin-left:5.2%;">
            <a href="DSBeginner.html">Data Science</a>
            <a href="DSIntermediate.html">Data Engineering</a>
            <a href="DSAdvanced.html">Software Engineering</a>
            <a href="Projects.html">Data Analytics</a>
          </div>
        </div>
        <div class="dropdown" style="margin-left:0px;">
            <button class="dropbtn" style="margin-left:60px;">Challenges
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content" style="max-width:190px;margin-left:4%;">
            <a href="DEBeginner.html">Beginner</a>
            <a href="DEIntermediate.html">Intermediate</a>
            <a href="DEAdvanced.html">Advanced</a>
          </div>
        </div>
        <div class="dropdown">
          <button class="dropbtn">Projects
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content" style="min-width:170px;margin-left:5.2%;">
            <a href="SEBeginner.html">Beginner</a>
            <a href="SEIntermediate.html">Intermediate</a>
            <a href="SEAdvanced.html">Advanced</a>
          </div>
        </div>
        <div class="dropdown" style="margin-left:0px;">
            <button class="dropbtn" style="margin-left:60px;">Related Topics
            <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content" style="min-width:155px;margin-left:4.5%;">
            <a href="DABeginner.html">Python</a>
            <a href="DAIntermediate.html">NoSQL Databases</a>
            <a href="DAAdvanced.html">Tableau</a>
            <a href="Projects.html">Pandas</a>
          </div>
        </div>
      </div>
  </header>
  <div class="wrapperTutorials" style="width:1200px;">
    <section>
      <h2><u>INTERMEDIATE SQL: CTEs</u></h2><br><br>
      <h3 style="margin-left:99px;"><b><u>Introduction</u></b></h3>
      <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
        After reading the tutorial on subqueries, you may have thought to yourself, "Why on earth would I use these when they are impossible to comprehend?" That's a great question. Luckily, the creators of SQL decided to create a much more comprehensive way of writing out multiple queries without using joins or unions: CTEs. <b><i>Common Table Expressions (CTEs)</i></b> are simply subqueries that are chained together through multiple uses of the WITH statement. This makes it significantly easier to read and comprehend long and complex subqueries.
      </p>
    </div>

                                                       <!-- CTEs vs. Subqueries -->
    <div class="wrapperTutorials" style="width:1200px;">
        <section>
      <h3 style="margin-left:99px;font-size:30px;"><b>CTEs vs. SUBQUERIES</b></h3>
      <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
        There tends to be three stages of writing code:
        <ul style="margin-left:110px;">
            <li style="line-height:25px;"><b>FIRST STAGE:</b> Knowing what code to write.</li>
            <li style="line-height:25px;"><b>SECOND STAGE</b> Understanding what the code is doing and how to fix errors.</li>
            <li style="line-height:25px;"><b>THIRD STAGE</b> Knowing how to write clean and fast code.</li>
        </ul>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
        Now that you know how to write SQL code and have a basic understanding of what it's doing and how to identify errors, let's learn how to write clean code by identifying the key differences between subqueries and CTEs:
        </p>
      <h4 style="margin-left:99px;font-size:22px;"><b>Examples</b></h4>
      <div class="grid-container" style="margin-left:70px;">
        <h5 style="margin-left:150px;font-size:22px;margin-top:0px;padding-top:0px;margin-bottom:20px;" class="item1"><b>(Subquery)</b></h5>
        <p style="text-align:left;padding-right:0px;font-size:16px;line-height:25px;color:black;font-weight:lighter;margin-bottom:0px;margin-top:50px;"class="item1">
        &ensp;&ensp;&ensp;SELECT customer_id, first_name, last_name,<br> 
        &ensp;&ensp;&ensp;SUM(order_amt) sales_total<br>
        &ensp;&ensp;&ensp;FROM customers<br>
        &ensp;&ensp;&ensp;WHERE customer_id IN <br>
        &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;<b>(SELECT DISTINCT customer_id FROM completed_sales);</b><br>
        &ensp;&ensp;&ensp;HAVING sales_total > 1500;
        <h5 style="margin-left:150px;font-size:22px;margin-top:0px;padding-top:0px;margin-bottom:20px;" class="item2"><b>(CTE)</b></h5>
            <p style="text-align:justify;padding-right:0px;font-size:16px;line-height:25px;color:black;font-weight:lighter;margin-bottom:0px;margin-top:50px;" class="item2">
                &ensp;&ensp;&ensp; <b>WITH</b> customer_sales AS (SELECT customer_id, first_name, last_name,<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;SUM(order_amt) sales_total<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;FROM customers<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;GROUP BY customer_id, first_name, last_name<br>
                &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;HAVING sales_total > 1500),<br><br>
                &ensp;&ensp;&ensp;all_customers AS <b>(SELECT DISTINCT customer_id FROM completed_sales);</b><br><br>
                &ensp;&ensp;&ensp;SELECT * FROM customer_sales<br>
                &ensp;&ensp;&ensp;JOIN <b>all_customers</b> ON all_customer.customer_id, customer_sales.customer_id;
        </p>
        </p>
        </div>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
            As can be seen above, although the CTE is much longer, it is much easier to understand the query due to the use of aliases and jojns rather than an unnamed subquery. However, there are times when subqueries may be necessary. For example, if you are trying to find customers with a particular characteristic (say their activity status), the characteristic will more than likely change over time. In these chases, it may be necessary to use a combination of both subqueries and CTEs.
        </p>
    </section>
    </div>
                                                        <!-- Best Practices -->
    <div class="wrapperTutorials" style="width:1200px;">
        <section>
        <h3 style="margin-left:99px;font-size:30px;"><b>BEST PRACTICES</b></h3>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
            Just like anything in SQL, there is always a good, bad, and better way of doing things. In the context of CTEs, listed below are some general rules of thumb to write effective CTEs:
            <ol style="margin-left:110px;">
                <li style="line-height:20px;margin-bottom:10px;"><b>ALWAYS write detailed aliases</b></li>
                <p style="line-height:25px;margin-left:30px;padding-right:100px;margin-bottom:15px;">The reason for this is <b>CLARITY</b>. If you are working on a team of analysts and one of your co-workers names a CTE "x" or "query", it makes it much more difficult to know what that CTE contains.</p>
                <li style="line-height:25px;margin-bottom:10px;"><b>Be LIBERAL with your comments</b></li>
                <p style="line-height:25px;margin-left:30px;padding-right:100px;margin-bottom:15px;">Just because it's easy for you to understand the query doesn't mean everyone else will understand it. Keep in mind that business stakeholders and other analysts will read your queries to make sure the data is correct. Comments allow you to "show your work" and explain your thought process.</p>
                <li style="line-height:25px;margin-bottom:10px;"><b>ALWAYS be descriptive when renaming columns</b></li>
                <p style="line-height:25px;margin-left:30px;padding-right:100px;margin-bottom:60px;">Similar to the first rule of thumb, when you are using aggregations or other functions within your CTEs, the calculations involvees can become mixed up within other CTEs. To help with this, it never hurts to rename the columns to something more descriptive. For example, rather than naming <b>SUM(sales)</b> "sales", name it something like "totalSales".</p>
            </ol>
        </p>
        </section>
        </div>

                                                         <!-- Conclusion -->
    <div class="wrapperTutorials" style="width:1200px;">
    <section>
        <h3 style="margin-left:99px;font-size:30px;"><b>CONCLUSION</b></h3>
        <p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">
        Although we didn't go into too much depth on the topic of the syntax of CTEs, it's more important to understand the use cases of them over subqueries. It's also very important to know when to use subqueries over CTEs or a combination of both. In any case, deep business knowledge is necessary to understand the type of analysis you're trying to conduct and how to most effectively communicate how you got the results.</p>
        </section>
        </div>


                                                        <!-- Next Steps -->
    <div class="wrapperTutorials" style="width:1200px;">
        <section>
        <h3 style="margin-left:99px;font-size:22px;"><b><u>Next Steps</u></b></h3><p style="text-align:justify;padding-left:100px;padding-right:100px;font-size:16px;line-height:25px;">Writing queries can be a tedious endeavor. Let's take a break and learn more about SQL's Data Analysis capabilities::<br>
            <a href="GroupByExtensions.html" style="text-decoration:none;color:black;font-weight:bolder;">- Group By Extensions Tutorial  (Click here)</a>
        </p>
        </section>
        </div>
        </p>


    
</html>